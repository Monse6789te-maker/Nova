<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nova - Detector de Residuos con IA</title>
    <meta name="description" content="Detecta residuos con IA y ahorra energía reciclando.">
    <meta name="theme-color" content="#0a1f0a">
    <link rel="manifest" href="manifest.json">
    <link rel="icon" href="nova-logo.png" type="image/png">
    
    <!-- TensorFlow.js -->
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.11.0"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/mobilenet@2.1.0"></script>

    <style>
        *{margin:0;padding:0;box-sizing:border-box}:root{--primary:#00ff00;--primary-dark:#00cc00;--primary-light:#33ff33;--bg-light:#0a1f0a;--bg-card:rgba(26,58,26,.45);--text-dark:#e0ffe0;--text-gray:#88cc88;--border:rgba(0,255,0,.3);--glass:rgba(255,255,255,.08);--glass-border:rgba(0,255,0,.25);--glow:0 0 20px rgba(0,255,0,.6);--glow-intense:0 0 40px rgba(0,255,0,.9)}body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;background:#0a1f0a;min-height:100vh;color:var(--text-dark);position:relative;overflow-x:hidden;padding-bottom:60px}body.dark-mode{--bg-card:rgba(15,31,15,.45);--glass:rgba(255,255,255,.05);--glass-border:rgba(0,255,0,.2)}.video-background{position:fixed;top:0;left:0;width:100%;height:100%;z-index:-1;overflow:hidden}.video-background::after{content:'';position:absolute;top:0;left:0;width:100%;height:100%;background:rgba(10,31,10,.65);backdrop-filter:blur(3px)}.video-background video{width:100%;height:100%;object-fit:cover;opacity:.7;filter:hue-rotate(20deg) saturate(1.3)}.container{max-width:1100px;margin:0 auto;padding:20px;position:relative;z-index:1}.glass-cardം{background:var(--glass);border-radius:24px;padding:24px;backdrop-filter:blur(16px) saturate(180%);-webkit-backdrop-filter:blur(16px) saturate(180%);border:1.5px solid var(--glass-border);box-shadow:0 8px 32px rgba(0,0,0,.2),inset 0 2px 8px rgba(255,255,255,.1),var(--glow);transition:all .4s;position:relative;overflow:hidden}.glass-card::before{content:'';position:absolute;top:0;left:0;width:100%;height:1px;background:linear-gradient(90deg,transparent,rgba(0,255,0,.4),transparent);animation:shimmer 3s infinite}.glass-card:hover{transform:translateY(-8px);box-shadow:0 16px 48px rgba(0,0,0,.3),inset 0 4px 16px rgba(255,255,255,.15),var(--glow-intense);border-color:rgba(0,255,0,.5)}@keyframes shimmer{0%,100%{transform:translateX(-100%)}50%{transform:translateX(100%)}}
        .header{text-align:center;padding:40px 20px 30px;margin-bottom:30px}.logo-icon{width:120px;height:120px;border-radius:28px;display:flex;align-items:center;justify-content:center;margin:0 auto 20px;position:relative;overflow:visible;background:linear-gradient(135deg,#0a1f0a,#1a3a1a);border:3px solid var(--primary);animation:float 3s ease-in-out infinite;z-index:1}.logo-icon::before,.logo-icon::after{content:'';position:absolute;width:140px;height:140px;border-radius:50%;border:2px solid transparent;border-top-color:var(--primary-light);border-right-color:var(--primary);animation:pulseRing 2s infinite ease-in-out;z-index:-1}.logo-icon::after{width:160px;height:160px;animation-delay:.5s;border-top-color:var(--primary);border-left-color:var(--primary-light)}@keyframes pulseRing{0%{transform:scale(.8);opacity:1}70%{transform:scale(1.3);opacity:.6}100%{transform:scale(1.5);opacity:0}}.logo-icon img{width:100%;height:100%;object-fit:contain;padding:10px;filter:drop-shadow(0 0 15px rgba(0,255,0,.7));z-index:2}.logo-icon-placeholder{font-size:3.5em;filter:drop-shadow(0 0 20px rgba(0,255,0,.9));z-index:2}@keyframes float{0%,100%{transform:translateY(0)}50%{transform:translateY(-10px)}}
        .header h1{font-size:2.8em;background:linear-gradient(135deg,var(--primary),var(--primary-light));-webkit-background-clip:text;background-clip:text;-webkit-text-fill-color:transparent;margin-bottom:8px;font-weight:700;filter:drop-shadow(0 0 20px rgba(0,255,0,.5))}.header p{color:var(--text-gray);font-size:1.05em}.theme-toggle{position:fixed;top:20px;right:20px;width:50px;height:50px;background:var(--bg-card);border:2px solid var(--border);border-radius:50%;cursor:pointer;font-size:1.3em;display:flex;align-items:center;justify-content:center;box-shadow:0 4px 12px rgba(0,0,0,.1);transition:all .3s;z-index:1000}.theme-toggle:hover{transform:scale(1.1) rotate(20deg)}
        .stats-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:20px;margin-bottom:30px}.stat-header{display:flex;align-items:center;gap:10px;margin-bottom:12px;color:var(--text-gray);font-size:.9em}.stat-icon{width:36px;height:36px;border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:1.2em;transition:all .3s;background:var(--primary);color:#000}.stat-value{font-size:2em;font-weight:700;color:transparent;background:linear-gradient(135deg,#00ff00,#33ff33,#00ff88);-webkit-background-clip:text;background-clip:text;animation:glowText 2s ease-in-out infinite;text-shadow:0 0 20px rgba(0,255,0,.6)}@keyframes glowText{0%,100%{text-shadow:0 0 20px rgba(0,255,0,.6)}50%{text-shadow:0 0 40px rgba(0,255,0,1)}}
        .progress-bar{width:100%;height:6px;background:rgba(0,255,0,.2);border-radius:3px;overflow:hidden;margin-top:8px}.progress-fill{height:100%;background:linear-gradient(90deg,var(--primary),var(--primary-light),var(--primary));background-size:200% 100%;animation:flow 3s linear infinite;border-radius:3px;position:relative;overflow:hidden;box-shadow:var(--glow-intense)}.progress-fill::after{content:'';position:absolute;right:0;top:0;width:20px;height:100%;background:linear-gradient(90deg,transparent,white);filter:blur(8px);animation:spark 1.5s infinite}@keyframes flow{0%{background-position:0% 0}100%{background-position:200% 0}}@keyframes spark{0%,100%{opacity:0;transform:translateX(-10px)}50%{opacity:1;transform:translateX(0)}}
        .logros-section{margin-bottom:30px}.logros-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px}.logros-header h2{font-size:1.3em;color:var(--text-dark);display:flex;align-items:center;gap:10px}.logros-counter{font-size:.9em;color:var(--text-gray)}.badges-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(70px,1fr));gap:15px}.badge{width:70px;height:70px;border-radius:16px;display:flex;align-items:center;justify-content:center;font-size:2em;transition:all .3s;cursor:pointer;position:relative;z-index:1;background:var(--bg-light);color:var(--text-gray)}.badge.unlocked{background:linear-gradient(135deg,#f59e0b,#fbbf24,#fde68a,#fbbf24,#f59e0b);background-size:200% 200%;animation:holographic 4s linear infinite,bounceIn .6s ease;box-shadow:0 4px 12px rgba(251,191,36,.4),0 0 20px rgba(251,191,36,.6);color:#000;position:relative;overflow:hidden}.badge.unlocked::before{content:'';position:absolute;top:-50%;left:-50%;width:200%;height:200%;background:linear-gradient(45deg,transparent,rgba(255,255,255,.3),transparent);transform:rotate(45deg);animation:shine 2s infinite}@keyframes holographic{0%{background-position:0% 50%}100%{background-position:200% 50%}}@keyframes shine{0%{transform:translateX(-100%) translateY(-100%) rotate(45deg)}100%{transform:translateX(100%) translateY(100%) rotate(45deg)}}@keyframes bounceIn{0%{transform:scale(0) rotate(-180deg)}50%{transform:scale(1.2) rotate(10deg)}100%{transform:scale(1) rotate(0deg)}}
        .tabs{display:flex;background:rgba(26,58,26,.8);border-radius:16px;padding:6px;margin-bottom:20px;box-shadow:0 4px 20px rgba(0,255,0,.15);border:2px solid rgba(0,255,0,.3);gap:6px;backdrop-filter:blur(10px)}.tab{flex:1;padding:14px;border:none;background:transparent;border-radius:12px;font-size:1em;font-weight:600;color:var(--text-gray);cursor:pointer;transition:all .3s;display:flex;align-items:center;justify-content:center;gap:8px}.tab.active{background:var(--primary);color:#0a1f0a;box-shadow:0 4px 15px rgba(0,255,0,.5)}.tab:hover:not(.active){background:rgba(0,255,0,.1);color:var(--primary)}
        .camera-btn-large{width:100%;padding:20px;background:linear-gradient(135deg,var(--primary),var(--primary-dark));color:white;border:none;border-radius:16px;font-size:1.1em;font-weight:600;cursor:pointer;transition:all .3s;display:flex;align-items:center;justify-content:center;gap:10px;box-shadow:0 4px 16px rgba(52,211,153,.3);margin:10px 0}.camera-btn-large:hover{transform:translateY(-2px);box-shadow:0 6px 20px rgba(52,211,153,.4)}.camera-btn-large.stop{background:linear-gradient(135deg,#ef4444,#dc2626)}
        .media-container{position:relative;border-radius:16px;overflow:hidden;background:#000;margin:20px 0;min-height:400px;display:flex;align-items:center;justify-content:center}#videoPreview,#imagePreview{width:100%;height:auto;max-height:60vh;object-fit:contain;display:none}#realtimeContainer{position:relative;overflow:hidden}.scan-line{position:absolute;top:0;left:0;width:100%;height:3px;background:linear-gradient(90deg,transparent,var(--primary),transparent);box-shadow:0 0 20px var(--primary);animation:scan 2s linear infinite;z-index:10}.detection-grid{position:absolute;top:0;left:0;width:100%;height:100%;background:repeating-linear-gradient(0deg,transparent,transparent 20px,rgba(0,255,0,.05) 20px,rgba(0,255,0,.05) 40px),repeating-linear-gradient(90deg,transparent,transparent 20px,rgba(0,255,0,.05) 20px,rgba(0,255,0,.05) 40px);animation:gridPulse 3s ease-in-out infinite;pointer-events:none;z-index:5}@keyframes scan{0%{transform:translateY(-100%)}100%{transform:translateY(100vh)}}@keyframes gridPulse{0%,100%{opacity:.3}50%{opacity:.6}}
        .energy-particle{position:fixed;border-radius:50%;pointer-events:none;z-index:0;animation:floatParticle 10s infinite ease-in-out;filter:blur(1px);box-shadow:0 0 15px currentColor}@keyframes floatParticle{0%,100%{transform:translateY(0) translateX(0);opacity:.3}25%{transform:translateY(-30px) translateX(20px);opacity:.6}50%{transform:translateY(-60px) translateX(-10px);opacity:.8}75%{transform:translateY(-30px) translateX(-30px);opacity:.6}}.cursor-particle{position:fixed;width:6px;height:6px;background:var(--primary);border-radius:50%;pointer-events:none;z-index:9999;animation:cursorTrail 1s ease-out forwards;box-shadow:0 0 15px var(--primary)}@keyframes cursorTrail{to{transform:translateY(-100px) scale(0);opacity:0}}
        @media (max-width:768px){.header h1{font-size:2.2em}.stats-grid{grid-template-columns:1fr 1fr}.glass-card{padding:18px}.logo-icon{width:100px;height:100px}.stat-value{font-size:1.6em}}
    </style>
</head>
<body>
    <!-- Fondo -->
    <div class="video-background">
        <video autoplay muted loop playsinline>
            <source src="Fondo.mp4" type="video/mp4">
            <source src="https://cdn.pixabay.com/vimeo/665175468/particles-76048.mp4?width=1280" type="video/mp4">
        </video>
    </div>

    <!-- Theme Toggle -->
    <button class="theme-toggle" id="themeToggle" onclick="document.body.classList.toggle('dark-mode'); this.innerHTML = document.body.classList.contains('dark-mode') ? 'Sol' : 'Luna'">Luna</button>

    <div class="container">
        <!-- Header -->
        <div class="header">
            <div class="logo-icon">
                <img src="nova-logo.png" alt="Logo" id="logoImage" style="display:none">
                <div class="logo-icon-placeholder" id="logoPlaceholder">Estrella</div>
            </div>
            <h1>Nova</h1>
            <p>Ahorra Energía Reciclando con IA</p>
        </div>

        <!-- Stats -->
        <div class="stats-grid">
            <div class="stat-card glass-card">
                <div class="stat-header"><div class="stat-icon nivel">Objetivo</div><span>Nivel</span></div>
                <div class="stat-value" id="levelDisplay">1</div>
                <div class="progress-bar"><div class="progress-fill" id="levelProgress" style="width:0%"></div></div>
            </div>
            <div class="stat-card glass-card">
                <div class="stat-header"><div class="stat-icon racha">Fuego</div><span>Racha</span></div>
                <div class="stat-value" id="streakDisplay">0 días</div>
            </div>
            <div class="stat-card glass-card">
                <div class="stat-header"><div class="stat-icon escaneos">Gráfico</div><span>Detecciones</span></div>
                <div class="stat-value" id="scansDisplay">0</div>
            </div>
            <div class="stat-card glass-card">
                <div class="stat-header"><div class="stat-icon co2">Planta</div><span>Energía Ahorrada</span></div>
                <div class="stat-value" id="co2Display">0.0 kWh</div>
            </div>
        </div>

        <!-- Logros -->
        <div class="logros-section glass-card">
            <div class="logros-header"><h2>Logros</h2><span class="logros-counter" id="badgeCounter">0/8</span></div>
            <div class="badges-grid" id="badgesGrid"></div>
        </div>

        <!-- Tabs -->
        <div class="tabs">
            <button class="tab active" onclick="switchTab('realtime')">Tiempo Real</button>
            <button class="tab" onclick="switchTab('upload')">Subir Imagen</button>
            <button class="tab" onclick="switchTab('guide')">Guía</button>
        </div>

        <!-- Contenido -->
        <div class="content-card glass-card">
            <div class="content-section active" id="realtimeSection">
                <button class="camera-btn-large" id="startBtn" onclick="startRealtime()">Iniciar Cámara</button>
                <button class="camera-btn-large stop" id="stopBtn" onclick="stopRealtime()" style="display:none">Detener</button>
                <div class="media-container" id="realtimeContainer" style="display:none">
                    <div class="scan-line"></div>
                    <div class="detection-grid"></div>
                    <video id="videoPreview" autoplay playsinline></video>
                </div>
            </div>

            <div class="content-section" id="uploadSection" style="display:none">
                <input type="file" id="imageInput" accept="image/*" style="display:none">
                <button class="camera-btn-large" onclick="document.getElementById('imageInput').click()">Subir Imagen</button>
                <div class="media-container" id="uploadContainer" style="display:none">
                    <img id="imagePreview">
                </div>
            </div>

            <div class="content-section" id="guideSection" style="display:none">
                <h3 style="color:var(--text-dark);margin-bottom:15px">Guía de Reciclaje</h3>
                <p style="color:var(--text-gray)">• Orgánicos: Verde<br>• Reciclables: Azul/Amarillo<br>• No reciclables: Gris</p>
            </div>
        </div>
    </div>

    <script>
        let model = null, stream = null;
        const gameData = {level:1, currentExp:0, maxExp:100, totalDetections:0, ecoImpact:0, badges:[]};

        // Partículas
        function createParticles() {
            for(let i=0;i<30;i++){
                const p=document.createElement('div');
                const s=4+Math.random()*6;
                const h=75+Math.random()*45;
                p.className='energy-particle';
                p.style.width=s+'px'; p.style.height=s+'px';
                p.style.left=Math.random()*100+'%'; p.style.top=Math.random()*100+'%';
                p.style.animationDelay=Math.random()*10+'s';
                p.style.background=`hsl(${h},100%,70%)`;
                p.style.color=`hsl(${h},100%,70%)`;
                document.body.appendChild(p);
            }
        }

        // Cursor
        let lastX=0,lastY=0;
        document.addEventListener('mousemove', e => {
            const dx=Math.abs(e.clientX-lastX), dy=Math.abs(e.clientY-lastY);
            if(dx+dy>30 && Math.random()<0.1){
                const p=document.createElement('div');
                p.className='cursor-particle';
                p.style.left=e.clientX+'px'; p.style.top=e.clientY+'px';
                document.body.appendChild(p);
                setTimeout(()=>p.remove(),1000);
            }
            lastX=e.clientX; lastY=e.clientY;
        });

        // Cargar modelo
        async function loadModel() {
            if(!model){
                model = await mobilenet.load();
                console.log('Modelo cargado');
            }
        }

        // Tiempo Real
        async function startRealtime() {
            await loadModel();
            stream = await navigator.mediaDevices.getUserMedia({video:{facingMode:'environment'}});
            const v = document.getElementById('videoPreview');
            v.srcObject = stream; v.style.display='block';
            document.getElementById('realtimeContainer').style.display='block';
            document.getElementById('startBtn').style.display='none';
            document.getElementById('stopBtn').style.display='flex';
            detectFrame();
        }

        function stopRealtime() {
            if(stream) stream.getTracks().forEach(t=>t.stop());
            document.getElementById('videoPreview').style.display='none';
            document.getElementById('realtimeContainer').style.display='none';
            document.getElementById('startBtn').style.display='flex';
            document.getElementById('stopBtn').style.display='none';
        }

        async function detectFrame() {
            if(!document.getElementById('videoPreview').style.display==='block') return;
            try {
                const preds = await model.classify(document.getElementById('videoPreview'));
                if(preds[0].probability > 0.6){
                    gameData.totalDetections++;
                    gameData.ecoImpact += 0.5;
                    updateStats();
                }
            } catch(e){}
            setTimeout(detectFrame, 2000);
        }

        // Subir imagen
        document.getElementById('imageInput').addEventListener('change', async e => {
            const file = e.target.files[0];
            if(file){
                const img = document.getElementById('imagePreview');
                img.src = URL.createObjectURL(file);
                img.style.display='block';
                document.getElementById('uploadContainer').style.display='block';
                await loadModel();
                const preds = await model.classify(img);
                alert(`Detectado: ${preds[0].className} (${(preds[0].probability*100).toFixed(1)}%)`);
                gameData.totalDetections++;
                gameData.ecoImpact += 0.8;
                updateStats();
            }
        });

        function updateStats() {
            document.getElementById('scansDisplay').textContent = gameData.totalDetections;
            document.getElementById('co2Display').textContent = gameData.ecoImpact.toFixed(1) + ' kWh';
            const progress = (gameData.currentExp / gameData.maxExp) * 100;
            document.getElementById('levelProgress').style.width = progress + '%';
        }

        function switchTab(tab) {
            document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
            document.querySelectorAll('.content-section').forEach(s=>s.style.display='none');
            event.target.classList.add('active');
            document.getElementById(tab+'Section').style.display='block';
        }

        // Logo
        window.onload = () => {
            createParticles();
            const img = document.getElementById('logoImage');
            img.onload = () => { img.style.display='block'; document.getElementById('logoPlaceholder').style.display='none'; };
            img.onerror = () => { document.getElementById('logoPlaceholder').style.display='block'; };
        };
    </script>
</body>
</html>
